
---
title: Push Stream RESTful API
description: 
platform: All Platforms
updatedAt: Fri Mar 26 2021 09:34:53 GMT+0800 (CST)
---
# Push Stream RESTful API
This service is not free.

This service is currently in the beta stage and may have some reliability risks. To ensure the quality of service, Agora strongly recommends that you use this service in Mainland China:

- Ensure that any servers that send HTTP requests are deployed in Mainland China.
- Ensure that the Converter that you created are located in Mainland China.

## Introduction

You can use the Push Stream RESTful API to convert the media stream within an Agora channel from the Agora private protocol to a standard protocol (such as RTMP) and then push the media stream to the CDN (Content Delivery Network). This process is equivalent to Agora processing the media stream through a Converter and pushing it to the CDN.

## Working principles

You can control a Converter through the following methods:

- `Create: `Create a Converter for your project, and set up the relevant configuration. The media stream in the channel will be processed by the Converter according to its configuration and then pushed to the CDN.
- `Delete: `Destroy the specified Converter. The user's media stream in this channel will no longer be processed by the Converter or pushed to the CDN after you destroy the Converter.
- `Update: `Update the specified Converter configuration.

The field structure of the Converter is shown in the following figure:

![img](https://confluence.agoralab.co/download/attachments/721388031/Map%20Shot%201616554188814.png?version=1&modificationDate=1616554228870&api=v2)

Details for these fields are shown in the following table:

<style> table th:first-of-type {     width: 150px; } th:third-of-type {     width: 170px; }</style>
| Field                                                        | Type        | Description                                                  |
| :----------------------------------------------------------- | :---------- | :----------------------------------------------------------- |
| id                                                   | String      | The ID of the Converter. This is a UUID (Universal Unique Identifier) generated by the Agora server to identify a created Converter. |
| name                                                     | String      | The name of the Converter.                                   |
| transcodeOptions                                         | JSON Object | The transcoding configuration of the Converter.              |
| transcodeOptions.rtcChannel                              | String      | The Agora channel name.                                      |
| transcodeOptions.audioOptions                              | JSON Object | The audio transcoding configuration of the Converter.        |
| transcodeOptions.audioOptions.codecProfile                 | String      | The audio codec output by the Converter.                     |
| transcodeOptions.audioOptions.sampleRate                  | Number      | The audio encoding sampling rate (Hz) output by the Converter. |
| transcodeOptions.audioOptions.bitrate                     | Number      | The audio encoding rate (Kbps) output by the Converter.      |
| transcodeOptions.audioOptions.audioChannels                | Number      | The number of audio channels output by the Converter.        |
| transcodeOptions.audioOptions.rtcStreamUids                | JSON Array  | The UID/account of the user participating in the mixing.     |
| transcodeOptions.videoOptions                              | JSON Object | The video transcoding configuration of the Converter.        |
| transcodeOptions.videoOptions.canvas                      | JSON Object | The video canvas.                                            |
| transcodeOptions.videoOptions.canvas.width                 | Number      | The width of the canvas (pixel).                             |
| transcodeOptions.videoOptions.canvas.height               | Number      | The height of the canvas (pixel).                            |
| transcodeOptions.videoOptions.canvas.color                 | Number      | The background color of the canvas. This is an RGB color value, expressed as a decimal number. For example, 255 represents blue. |
| transcodeOptions.videoOptions.layout                      | JSON Array  | The content description of the video screen on the canvas. Two elements are supported: RtcStreamView and ImageView. |
| transcodeOptions.videoOptions.layout.RtcStreamView         | NA          | The video screen of each user on the canvas.                 |
| transcodeOptions.videoOptions.layout.RtcStreamView.rtcStreamUid | Number      | The UID of the user to which the video stream belongs.       |
| transcodeOptions.videoOptions.layout.RtcStreamView.rtcStreamAccount | String      | The account of the user to which the video stream belongs.   |
| transcodeOptions.videoOptions.layout.RtcStreamView.region  | JSON Object | The display area of the user's video screen on the canvas.   |
| transcodeOptions.videoOptions.layout.RtcStreamView.region.xPos | Number      | The x coordinate (pixel) of the screen on the canvas. This is the lateral displacement relative to the origin, where the upper left corner of the canvas is the origin, and the x coordinate is the upper left corner of the screen. |
| transcodeOptions.videoOptions.layout.RtcStreamView.region.yPos | Number      | The y coordinate (pixel) of the screen on the canvas. This is the longitudinal displacement to the origin, where the upper left corner of the canvas is the origin and the y coordinate is the upper left corner of the screen. |
| transcodeOptions.videoOptions.layout.RtcStreamView.region.zIndex | Number      | The layer number of the screen. The value range is [0,100]. `0` represents the lowest layer. `100` represents the top layer. |
| transcodeOptions.videoOptions.layout.RtcStreamView.region.width | Number      | The width of the screen (pixels).                            |
| transcodeOptions.videoOptions.layout.RtcStreamView.region.height | Number      | The height of the screen (pixels).                           |
| transcodeOptions.videoOptions.layout.RtcStreamView.placeholderImageUrl | String      | The HTTP(S) URL of the substitute image.                     |
| transcodeOptions.videoOptions.layout.ImageView             | NA          | The video image on the canvas, which can be used as a watermark. |
| transcodeOptions.videoOptions.layout.ImageView.imageUrl    | String      | The HTTP(S) URL of the image.                                |
| transcodeOptions.videoOptions.layout.ImageView.region      | JSON Object | The display area of the image on the canvas.                 |
| transcodeOptions.videoOptions.layout.ImageView.region.xPos | Number      | The x coordinate (pixel) of the image on the canvas. This is the lateral displacement relative to the origin, where the upper left corner of the canvas is the origin, and the x coordinate is the upper left corner of the screen. |
| transcodeOptions.videoOptions.layout.ImageView.region.yPos | Number      | The y coordinate (pixel) of the picture on the canvas. The longitudinal displacement to the origin.（Take the upper left corner of the canvas as the origin and the y coordinate as the upper left corner of the screen.） |
| transcodeOptions.videoOptions.layout.ImageView.region.zIndex | Number      | The layer number of the image. The value range is [0,100]. `0` represents the lowest layer. `100` represents the top layer. |
| transcodeOptions.videoOptions.layout.ImageView.region.width | Number      | The width of the image (pixels).                             |
| transcodeOptions.videoOptions.layout.ImageView.region.height | Number      | The height of the image (pixels).                            |
| transcodeOptions.videoOptions.bitrate                      | Number      | The encoding bitrate (Kbps) of the video.                    |
| transcodeOptions.videoOptions.frameRate                    | Number      | The encoding frame rate (fps) of the video.                  |
| transcodeOptions.videoOptions.codecProfile                 | String      | The encoding specification of the video.                     |
| transcodeOptions.videoOptions.seiExtraInfo                | String      | The user SEI information in the video. This is used to send user-defined SEI information to the CDN. The length is limited to 4,096 bytes. The default is empty. |
| rtmpUrl                                                    | String      | The CDN streaming address.                                   |
| idleTimeOut                                               | Number      | The maximum time (seconds) that the Converter is idle. Idle means that all users corresponding to the media stream processed by the Converter have left the channel. The value range is [5,600]. The default value is 300. An error will be reported if the value falls outside the range. |
| createTs                                                  | Number      | The Unix timestamp (seconds) when the Converter was created. |
| updateTs                                                  | Number      | The Unix timestamp (seconds) when the Converter configuration was last updated. |
| state                                                     | String      | The running status of the Converter:<li>idle: Pushing the stream has not started or has ended.</li><li>connecting: Connecting to the Agora streaming server and the CDN server.</li><li>running: Pushing the stream.</li><li>recovering: Resuming pushing the stream.</li><li>failure: Failed to push the stream.</li> |

The following is a complete converter example:

```json
{
    "id": "4c014467d647bb87b60b719f6fa57686",
    "name": "show68_vertical",
    "transcodeOptions": {
        "rtcChannel": "show68",
        "audioOptions": {
            "codecProfile": "HE-AAC",
            "sampleRate": 48000,
            "bitrate": 128,
            "audioChannels": 1,
            "rtcStreamUids": [
                201
            ]
        },
        "videoOptions": {
            "canvas": {
                "width": 360,
                "height": 640,
                "color": 0
            },
            "layout": [
                {
                    "rtcStreamUid": 201,
                    "region": {
                        "xPos": 0,
                        "yPos": 0,
                        "zIndex": 1,
                        "width": 360,
                        "height": 320
                    },
                    "placeholderImageUrl": "http://example.agora.io/host_placeholder.jpg"
                },
                {
                    "rtcStreamUid": 202,
                    "region": {
                        "xPos": 0,
                        "yPos": 320,
                        "zIndex": 1,
                        "width": 360,
                        "height": 320
                    }
                },
                {
                    "imageUrl": "http://example.agora.io/watchmark.jpg",
                    "region": {
                        "xPos": 0,
                        "yPos": 0,
                        "zIndex": 2,
                        "width": 36,
                        "height": 64
                    }
                }
            ],
            "codecProfile": "High",
            "frameRate": 15,
            "bitrate": 400,
            "seiExtraInfo": "xxxyyyzzz"
        }
    },
    "rtmpUrl": "rtmp://example.agora.io/live/show68",
    "idleTimeout": 300,
    "createTs": 1591786766,
    "updateTs": 1591786835,
    "state": "connecting"
}
```

### Prerequisites

Contact Agora to gain access to **RTMP Converter** service.

## Create: Create a Converter

### HTTP request

```http
POST https://api.agora.io/v1/projects/<appId>/rtmp-converters 
```

#### Path parameter

`appId`: (Required) String. The **App ID** provided by Agora. You can get an App ID after creating a project in the Agora console. An App ID is the unique identification of a project.

#### Query parameters

`regionHintIp`: (Optional) String. The IP address of the CDN source station. It must be a valid IPv4 address. This parameter can help ensure the stability of the RTMP stream.

```http
POST https://api.agora.io/v1/projects/<appId>/rtmp-converters?regionHintIp={regionHintIp} 
```

#### Header field of the request message

- `Content-Type`: `application/json`

- `Authorization`: The value of this field must refer to the [Authentication instructions](https://docs.agora.io/en/All/faq/restful_authentication).

- `X-Request-ID`: The UUID (Universal Unique Identifier) that identifies this **request**. After passing in this field, the Agora server returns this field in the response header.

  > Agora recommends that you assign a value to `X-Request-ID`. If you do not assign a value, the Agora server will generate a UUID to pass in automatically.

#### Body of the request message

This example shows that the video of the two specified users in the `show68` channel are mixed and pushed to the CDN. The audio of all users in the channel is also mixed.

```json
{
    "converter": {
        "name": "show68_vertical",
        "transcodeOptions": {
            "rtcChannel": "show68",
            "audioOptions":{
                "codecProfile": "LC-AAC",
                "sampleRate": 48000,
                "bitrate": 48,
                "audioChannels": 1
            }
            "videoOptions": {
                "canvas": {
                    "width": 360,
                    "height": 640
                },
                "layout": [
                    {   "rtcStreamUid": 201,
                        "region": {
                            "xPos": 0,
                            "yPos": 0,
                            "zIndex": 1,
                            "width": 360,
                            "height": 320
                        },
                        "placeholderImageUrl": "http://example.agora.io/user_placeholder.jpg"
                    },
                    {   "rtcStreamUid": 202,
                        "region": {
                            "xPos": 0,
                            "yPos": 320,
                            "zIndex": 1,
                            "width": 360,
                            "height": 320
                        }
                    }
                ],
                "bitrate": 800
            }
        },
        "rtmpUrl": "rtmp://example.agora.io/live/show68"
    }
 }
```

The request Body is the `converter` field of JSON Object type. The field structure is shown in the following figure:

![img](https://confluence.agoralab.co/download/attachments/721388031/Map%20Shot%201616556076907.png?version=1&modificationDate=1616556096430&api=v2)

Details for these fields are shown in the following table:

<style> table th:first-of-type {     width: 150px; } th:third-of-type {     width: 170px; }</style>
| Field                                                        | Type                   | Descriptions                                                 |
| :----------------------------------------------------------- | :--------------------- | :----------------------------------------------------------- |
| name                                                    | (Optional) String      | The name of the Converter. The maximum length is 64 characters. The supported character set range is:<li>All lowercase English letters (a-z)</li><li>All uppercase English letters (A-Z)</li><li>Numbers 0-9</li><li>"-", "_"</li>The field is empty when no value is passed. Multiple converters with an empty name field can be created under a project. Two converters cannot have the same name, however; you will receive a response status code of 409 (Conflict) if you try to create a converter with the same name as one that already exists under that project. <div class="alert note">To avoid repeatedly creating multiple Converters and repetitively pushing streams, please use the <code>name</code> field to manage the Converters under the specified project. Agora recommends that you combine "channel name (<code>rtcChannel</code>)" and "Converter feature" to assign a value to the <code>name</code>. For example, <code>show68_horizontal</code> and <code>show68_vertical</code> would represent converters for the user screen created in channel <code>show68</code> with horizontal and vertical layouts, respectively.</div> |
| transcodeOptions                                         | (Required) JSON Object | The Converter’s transcoding configuration. <li>When the audioOptions and videoOptions fields in converter.transcodeOptions are not defined, the converter will output a video stream only (without audio).</li><li>When there is no `rtcStreamUids` field in the `converter.transcodeOptions.audioOptions` field, Agora will mix the audio streams of all users in the channel and output the mixed audio stream through the Converter.</li><li>When there is an `rtcStreamUids` field in the `converter.transcodeOptions.audioOptions` field, Agora will mix the audio stream of the specified user and output the mixed audio stream through the Converter.</li> |
| transcodeOptions.rtcChannel                                | (Required) String      | The Agora channel name. This is the channel to which the stream processed by the Converter belongs. The maximum length of the string is 64 characters, and the following character sets (89 characters in total) are supported:<li>All lowercase English letters (a-z)</li><li>All uppercase English letters (A-Z)</li><li>Numbers 0-9The space character</li><li>"!", "#", "$", "%", "&", "(", ")", "+", "-", ":", ";", "<", "=", ".", ">", "?", "@", "[", "]", "^", "_", " {", "}", "\|", "~", "," </li>|
| transcodeOptions.audioOptions                              | (Optional) JSON Object | The audio transcoding configuration of the Converter.        |
| transcodeOptions.audioOptions.codecProfile                 | (Optional)String       | The audio codec output by the Converter. The following values are supported:<li><code>`LC-AAC`</code> (Default): MPEG-4 AAC LC</li><li><code>HE-AAC</code>: High-Efficiency AAC</li> |
| transcodeOptions.audioOptions.sampleRate                   | (Optional) Number      | The audio coding sampling rate (Hz) output by the Converter, which can can be `32000`, `44100,` or `48000 `(Default value). |
| transcodeOptions.audioOptions.bitrate                      | (Optional) Number      | The audio encoding bit rate (Kbps) output by the Converter. The value range is [32,128]. The default value is 48. If the audio codec is LC-AAC, the recommended audio code rate range is [32,112]. If the audio codec is HE-AAC, the recommended audio code rate range is [40,96]. |
| transcodeOptions.audioOptions.audioChannels               | (Optional) Number      | The number of audio channels output by the Converter , which can be `1` (Default) or `2`. |
| transcodeOptions.audioOptions.rtcStreamUids                | (Optional) JSON Array  | The UID/account of the user participating in the mixing. The default value is an empty array, which means that Agora will not mix any user's audio streams. |
| transcodeOptions.videoOptions                             | (Optional) JSON Object | The video transcoding configuration of the Converter.        |
| transcodeOptions.videoOptions.canvas                     | (Required) JSON Object | The video canvas.                                            |
| transcodeOptions.videoOptions.canvas.width                 | (Required) Number      | The width of the canvas (pixels). The value range is [66,1920]. |
| transcodeOptions.videoOptions.canvas.height                | (Required) Number      | The height of the canvas (pixels). The value range is [66,1920]. |
| transcodeOptions.videoOptions.canvas.color                | (Optional) Number      | The background color of the canvas. This is an RGB color value, expressed as a decimal number. For example, 255 represents blue. The value range is [0,16777215]. The default value is 0, which is black. |
| transcodeOptions.videoOptions.layout                     | (Required) JSON Array  | The content description of the video screen on the canvas. Two elements are supported: RtcStreamView and ImageView. |
| transcodeOptions.videoOptions.layout.RtcStreamView element | None                   | The video screen of each user on the canvas. Agora supports user names in the channel as Number type UID or String type account. If you use a String type account, please make sure you have read [how to use a String type user name](https://docs.agora.io/en/All/faq/string). |
| transcodeOptions.videoOptions.layout.RtcStreamView element.rtcStreamUid | Number                 | The UID of the user to which the video stream belongs. Please use only one of either rtcStreamUid or rtcStreamAccount per user. |
| transcodeOptions.videoOptions.layout.RtcStreamView element.rtcStreamAccount | String                 | The account of the user to which the video stream belongs. Please use only one of either rtcStreamUid or rtcStreamAccount per user. |
| transcodeOptions.videoOptions.layout.RtcStreamView element.region | (Required) JSON Object | The display area of the user's video screen on the canvas. If the video screen dimensions exceed the canvas, the screen will be cropped, and the excess image will not be displayed. |
| transcodeOptions.videoOptions.layout.RtcStreamView element.region.yPos | (Required) Number      | The x coordinate (pixel) of the screen on the canvas. This is the lateral displacement relative to the origin, where the upper left corner of the canvas is the origin, and the x coordinate is the upper left corner of the screen. |
| transcodeOptions.videoOptions.layout.RtcStreamView element.region.yPos | (Required) Number      | The y coordinate (pixel) of the screen on the canvas. This is the longitudinal displacement relative to the origin, where the upper left corner of the canvas is the origin, and the y coordinate is the upper left corner of the screen.） |
| transcodeOptions.videoOptions.layout.RtcStreamView element.region.zIndex | (Required) Number      | The layer number of the screen. The value range is [0,100]. `0` represents the lowest layer. `100` represents the top layer. |
| transcodeOptions.videoOptions.layout.RtcStreamView element.region.width | (Required) Number      | The width of the screen (pixels).                            |
| transcodeOptions.videoOptions.layout.RtcStreamView element.region.height | (Required) Number      | The height of the screen (pixels).                           |
| transcodeOptions.videoOptions.layout.RtcStreamView element.placeholderImageUrl | (Required) String      | The HTTP(S) URL of the substitute image. Images in JPG and PNG formats are supported. When the user in the channel does not publish the video stream, if this field is set, this substitute image will replace the user's video screen; otherwise, the last frame of the user's video will be displayed. |
| transcodeOptions.videoOptions.layout.ImageView element     | None                   | The video image on the canvas, which can be used as a watermark. |
| transcodeOptions.videoOptions.layout.ImageView element.imageUrl | (Required) String      | The HTTP(S) URL of the image. Images in JPG and PNG formats are supported. |
| transcodeOptions.videoOptions.layout.ImageView element.region | (Required) JSON Object | The display area of the image on the canvas. If the video screen dimensions exceed the canvas, the screen will be cropped, and the excess image will not be displayed. |
| transcodeOptions.videoOptions.layout.ImageView element.region.xPos | (Required) Number      | The x coordinate (pixel) of the image on the canvas. This is the lateral displacement relative to the origin, where the upper left corner of the canvas is the origin, and the x coordinate is the upper left corner of the screen. |
| transcodeOptions.videoOptions.layout.ImageView element.region.yPos | (Required) Number      | The y coordinate (pixel) of the picture on the canvas. This is the longitudinal displacement relative to the origin, where the upper left corner of the canvas is the origin and the y coordinate is the upper left corner of the screen. |
| transcodeOptions.videoOptions.layout.ImageView element.region.zIndex | (Required) Number      | The layer number of the image. The value range is [0,100]. `0` represents the lowest layer. `100` represents the top layer. |
| transcodeOptions.videoOptions.layout.ImageView element.region.width | (Required) Number      | The width of the image (pixels).                             |
| transcodeOptions.videoOptions.layout.ImageView element.region.height | (Required) Number      | The height of the image (pixels).                            |
| transcodeOptions.videoOptions.bitrate                     | (Required) Number      | The encoding bitrate (Kbps) of the video. The value range is [1,10000]. |
| transcodeOptions.videoOptions.frameRate                   | (Optional) Number      | The encoding frame rate (fps) of the video. The value range is [1,30]. The default value is 15. |
| transcodeOptions.videoOptions.codecProfile                 | (Optional) String      | The encoding specification of the video. The following values are supported:<li>`high` (Default): High video codec profile, generally used for high-resolution broadcasts or television.</li><li>`baseline`: Baseline video codec profile, generally used for video calls on mobile phones.</li><li>`main`: Main video codec profile, generally used for mainstream electronics, such as MP4 players, portable video players, PSPs, and iPads.</li> |
| transcodeOptions.videoOptions.seiExtraInfo                 | (Optional) String      | The user SEI information in the video. This is used to send user-defined SEI information to the CDN. The length is limited to 4,096 bytes. The default is empty. See [The Agora SEI](https://docs.agora.io/en/All/faq/sei) for details. |
| rtmpUrl                                                    | (Required) String      | The CDN streaming address. It must be a valid RTMP address with a length of 1,024 characters or less. |
| idleTimeOut                                              | (Optional) Number      | The maximum time (seconds) that the Converter is idle. Idle means that all users corresponding to the media stream processed by the Converter have left the channel. After the idle state exceeds the set `idleTimeOut`, the Converter will be destroyed automatically. |

### HTTP response

All possible response status codes. See Status codes for details.

#### Header field of the response message.

- `X-Request-ID`: The UUID (Universal Unique Identifier) that identifies this **request**. This value is the same as the `X-Request-ID` in the header of this request. If there is an error in the request, please print out the value in the log to troubleshoot the problem.

  > If the response status code of this request is not 2XX, this field may be missing from the response header.

- `X-Resource-ID`: The UUID (Universal Unique Identifier) that identifies the **ID** of the Converter updated in this request.

#### Body of the response message

```
{
   "converter": {
     "id": "4c014467d647bb87b60b719f6fa57686",
     "createTs": 1591786766,
     "updateTs": 1591786766,
     "state": "connecting"
   },
   "fields": "id,createTs,updateTs,state"
}
```

If the status code is 2XX, the request is successful. The field structure is shown in the following figure:

![img](https://confluence.agoralab.co/download/attachments/721388031/Map%20Shot%201616559188168.png?version=1&modificationDate=1616559201302&api=v2)

Details for these fields are shown in the following table:

| Field      | Type   | Descriptions                                                 |
| :--------- | :----- | :----------------------------------------------------------- |
| id       | String | The ID of the Converter. This is a UUID (Universal Unique Identifier) generated by the Agora server to identify a created Converter. |
| createTs | Number | The Unix timestamp(seconds) when the Converter was created.  |
| updateTs | Number | The Unix timestamp(seconds) when the Converter configuration was last updated. |
| state    | String | The running status of the Converter:<li>idle: Pushing the stream has not started or has ended.</li><li>connecting: Connecting to the Agora streaming server and the CDN server.</li><li>running: Pushing the stream.</li><li>recovering: Resuming pushing the stream.</li><li>failure: Failed to push the stream.</li> |
| fields   | String | The field mask of the converter JSON Object. See [Google protobuf FieldMask Document](https://developers.google.com/protocol-buffers/docs/reference/google.protobuf#fieldmask) for details. This is used to describe the set of fields contained in the returned `converter`. In this example, `fields` specifies that the Agora server returns a subset of the `id`, `createTs`, `updateTs` and `state` fields in the `converter` field. |

If the status code is not 2XX, the request fails. The body contains a String type `message` field that describes the specific reason for the failure.

```json
{
    "message": "Invalid authentication credentials."
 }
```

## Delete: Destroy the specified Converter.

### HTTP request

```http
DELETE https://api.agora.io/v1/projects/<appId>/rtmp-converters/<converterId> 
```

#### Path parameter

- `appId`: (Required) String type parameter. The **App ID** provided by Agora . You can get an App ID after creating a project in the Agora console. An App ID is the unique identification of a project.
- `converterId`: (Required) String type parameter. The **ID** of the Converter.

#### Query Parameters

None

#### Header field of the request message

- `Authorization`: The value of this field must refer to the [Authentication instructions](https://docs.agora.io/cn/faq/restful_authentication).

- `X-Request-ID`: The UUID (Universal Unique Identifier) that identifies this **request**. After passing in this field, the Agora server will return this field in the response header.

  > Agora recommends that you assign a value to `X-Request-ID`. If you do not assign a value, the Agora server will generate a UUID to pass in automatically.

#### Body of the request message

None

### HTTP response

All possible response status codes. See Status Codes for details.

#### Header field of the response message.

- `X-Request-ID`: The UUID (Universal Unique Identifier) that identifies this **request**. This value is the same as the `X-Request-ID` in the header of this request. If there is an error in the request, please print out the value in the log to troubleshoot the problem.

  > If the response status code of this request is not 2XX, this field may be missing from the response header.

- `X-Resource-ID`: The UUID (Universal Unique Identifier) that identifies the **ID** of the Converter created in this request.

#### Body of the response message

- If the status code is 2XX, the request is successful. The body is empty.
- If the status code is not 2XX, the request fails. The body contains a String type `message` field that describes the specific reason for the failure.

## Update: Update the specified Converter configuration.

### HTTP request

```http
PATCH https://api.agora.io/v1/projects/<appId>/rtmp-converters/<converterId> 
```

#### Path parameter

- `appId`: (Required) String type parameter. The **App ID** provided by Agora. You can get an App ID after creating a project in the Agora console. An App ID is the unique identification of a project.
- `converterId`: (Required) String type parameter. The **ID** of the Converter.

#### Query Parameters

`sequence`: **(Required)** Number type parameter. The serial number of the `Update` request. The value must be greater than or equal to 0. Please make sure that the serial number of the next `Update` request is greater than the serial number of the previous `Update` request. The serial number can ensure that the Agora server updates the Converter according to the latest configuration you specify.

> Agora recommends that you fill in `sequence` sequentially, using 0 when calling Update for the first time, 1 for the second time, 2 for the third time, and so on. The Agora server will update the Converter according to the latest Update request (the largest serial number).

```http
PATCH https://api.agora.io/v1/projects/<appId>/rtmp-converters/<converterId>?sequence={sequence} 
```

#### Header field of the request message

- `Content-Type`: `application/json`

- `Authorization`: The value of this field must refer to the [Authentication instructions](https://docs.agora.io/cn/faq/restful_authentication).

- `X-Request-ID`: The UUID (Universal Unique Identifier) that identifies this **request**. After passing in this field, the Agora server will return this field in the response header.

  > Agora recommends that you assign a value to `X-Request-ID`. If you do not assign a value, the Agora server will generate a UUID to pass in automatically.

#### Body of the request message

- Update `converter.transcodeOptions.videoOptions.layout` configuration. Please refer to the following sample code:

  ```json
  {
      "converter": {
          "transcodeOptions": {
              "videoOptions": {
                  "layout": [
                      {
                          "rtcStreamUid": 201,
                          "region": {
                              "xPos": 0,
                              "yPos": 0,
                              "zIndex": 1,
                              "width": 360,
                              "height": 320
                          },
                          "placeholderImageUrl": "http://example.agora.io/host_placeholder.jpg"
                      },
                      {
                          "rtcStreamUid": 703,
                          "region": {
                              "xPos": 0,
                              "yPos": 320,
                              "zIndex": 1,
                              "width": 360,
                              "height": 320
                          },
                          "placeholderImageUrl": "http://example.agora.io/guest_placehoder.jpg"
                      }
                  ]
              }
          }
      },
      "fields": "transcodeOptions.videoOptions.layout"
  }
  ```

- Update `converter.transcodeOptions.audioOptions.rtcStreamUids` configuration. Please refer to the following sample code:

  ```json
  {
      "converter": {
          "transcodeOptions": {
              "audioOptions": {
                  "rtcStreamUids": [
                      201,
                      202
                  ]
              }
          },
          "fields": "transcodeOptions.audioOptions.rtcStreamUids"
      }
  }
  ```

- Update other configurations of the converter, such as `converter.rtmpUrl`:

  ```json
  {
      "converter": {
          "rtmpUrl": "rtmp://example.agora.io/live/show68_backup"
      },
      "fields": "rtmpUrl"
  }
  ```

For details about these fields, see the Create request body.

> Update does not support updating the following configurations of a Converter:
>
> - `name`
> - `idleTimeOut`
> - `transcodeOptions.rtcChannel`
> - `transcodeOptions.audioOptions`
> - `transcodeOptions.audioOptions.codecProfile`
> - `transcodeOptions.audioOptions.sampleRate`
> - `transcodeOptions.audioOptions.bitrate`
> - `transcodeOptions.audioOptions.audioChannels`
> - `transcodeOptions.videoOptions.codecProfile`

After calling the `Create` method to create a Converter that outputs video stream only or audio stream only, you cannot update it to a Converter that outputs audio stream only or video stream only through the ``Update`` method.

### HTTP response

All possible response status codes. See Status Codes for details.

#### Header field of the response message.

- `X-Request-ID`:The UUID (Universal Unique Identifier) that identifies this **request**. This value is the same as the `X-Request-ID` in the header of this request. If there is an error in the request, please print out the value in the log to troubleshoot the problem.

  > If the response status code of this request is not 2XX, this field may be missing from the response header.

- `X-Resource-ID`: The UUID (Universal Unique Identifier) that identifies the **ID** of the Converter updated in this request.

#### Body of the response message

```
{
   "converter": {
     "id": "4c014467d647bb87b60b719f6fa57686",
     "createTs": 1591786766,
     "updateTs": 1591788746,
     "state": "running"
   },
   "fields": "id,createTs,updateTs,state"
}
```

If the status code is 2XX, the request is successful. The field structure is shown in the following figure:

![img](https://confluence.agoralab.co/download/attachments/721388031/Map%20Shot%201616559188168.png?version=1&modificationDate=1616559201302&api=v2)

Details of these fields are shown in the following table:

| Field      | Type   | Descriptions                                                 |
| :--------- | :----- | :----------------------------------------------------------- |
| id       | String | The ID of the Converter. This is a UUID (Universal Unique Identifier) generated by the Agora server to identify a created Converter. |
| createTs | Number | The Unix timestamp(seconds) when the Converter was created.  |
| updateTs | Number | The Unix timestamp(seconds) when the Converter configuration was last updated. |
| state   | String | The running status of the Converter:<li>idle: Pushing the stream has not started or has ended.</li><li>connecting: Connecting to the Agora streaming server and the CDN server.</li><li>running: Pushing the stream.</li><li>recovering: Resuming pushing the stream.</li><li>failure: Failed to push the stream.</li> |
| fields  | String | Field mask of JSON, see [Google protobuf FieldMask Document](https://developers.google.com/protocol-buffers/docs/reference/google.protobuf#fieldmask) for details. This is used to describe the set of fields contained in the returned `converter`. <br>In this example, `fields` specifies that the Agora server returns a subset of the `id`, `createTs`, `updateTs` and `state` fields in the `converter` field. |

If the status code is not 2XX, the request fails. The body contains a String type `message` field that describes the specific reason for the failure.

## API call rate limits

The Agora server limits the call rate for the Push Stream API by method. When a call rate exceeds its limit, the status code `429 (Too Many Requests)` is returned. If you need a higher call rate, please contact technical support.

| API      | Rate limits                                                  |
| :------- | :----------------------------------------------------------- |
| `Create` | In a project, the rate limit for the rate of creating a Converter is 50 times per second. |
| `Delete` | In a project, the rate limit for the converter destruction is 100 times per second. |
| `Update` | In a project, the rate limit for the rate of updating a specified Converter is 2 times per second. |



## Status codes

- If the status code is 2XX, the request is successful.
- If the status code is not 2XX, the request fails. Please troubleshoot the problem based on the content of the `message` field in the corresponding response message Body.

| Status codes            | Possible message field content                               |
| :---------------------- | :----------------------------------------------------------- |
| 200 OK                  | /                                                            |
| 400 Bad Request         | Invalid parameter: rtmpUrl. Replace it, and retry.Invalid parameter: idleTimeout. Replace it, and retry. |
| 401 Unauthorized        | Invalid authentication credentials.                          |
| 403 Forbidden           | The project lacks permission to use this function. Contact Agora for support. |
| 404 Not Found           | Resource is not found and destroyed.                         |
| 409 Conflict            | Resource with the same name has already existed. Use the existing resource, otherwise delete it and create a new resource. |
| 429 Too Many Requests   | Request rate limit exceeded.Resource quota limit exceeded.No available resources. |
| 500 Unknown             | Internal errors. Contact us for troubleshooting.             |
| 501 Not Implemented     | The method requested has not been implemented.               |
| 503 Service Unavailable | The server is temporarily overloading. Retry with a backoff strategy and contact us for troubleshooting.The server is temporarily down. Retry with a backoff strategy. |
| 504 Gateway Timeout     | Gateway timeout. Check whether the resource is created, if not, re-create a new resource. |

## Callback notification

After using the Push Stream RESTful API, the Agora message notification server will send a callback notification to your server via HTTP or HTTPS requests. For details, please refer to [Message Notification Service](https://docs-preview.agoralab.co/cn/Agora Platform/nscstreaming?platform=All Platforms).

## Note

This section summarizes the most important considerations for using the Push Stream RESTful API.

| Note                                                         | Influence level |
| :----------------------------------------------------------- | :-------------- |
| Note                                                         | Influence level |
| Please make sure that the Agora channel scene is live.       | ★★★☆☆           |
| If you need only one Converter in a channel, you must use the `name` parameter. See the `name` parameter explanation for details. | ★★★☆☆           |
| By default, Agora creates a Converter in the region where your business server is located. If the CDN service you are using is not in the same region as the business server, please use the `regionHintIp` reference to force Agora to create a Converter in the region where the CDN service is located; this will improve the stability of the RTMP stream. See the `regionHintIp` parameter explanation for details. | ★★★★★           |
| If the Converter is automatically destroyed due to service failures (or other reasons), Agora recommends that you create a new Converter. | ★★★★★           |
| After creating a Converter, if the CDN side pulls the stream abnormally, Agora recommends that you `Delete` a Converter and create a new Converter. | ★★★★★           |
| Please make sure that the `sequence` value is incremented when you ``Update`` the same Converter multiple times. Please refer to the `sequence` parameter explanation for details. | ★★★★★           |
| When there is an error in the request, please be sure to print out the `X-Request-ID` and `X-Resource-ID` field values of the response header in the log to facilitate troubleshooting. | ★★★☆☆           |
